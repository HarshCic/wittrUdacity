{"version":3,"sources":["Settings.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;uBAAoB,SAAS;;;;oBACZ,MAAM;;;;2BACC,aAAa;;;;sBACV,QAAQ;;4BACV,gBAAgB;;;;8BACf,mBAAmB;;;;iCAChB,sBAAsB;;;;AAEnD,IAAM,UAAU,GAAG,8BAAY;AAC7B,OAAK,EAAE,kBAAK,eAAe;CAC5B,CAAC,CAAC;;AAEH,IAAM,eAAe,GAAG,CAAC,SAAS,EAAE,MAAM,EAAE,QAAQ,EAAE,SAAS,CAAC,CAAC;;IAE5C,MAAM;YAAN,MAAM;;AACd,WADQ,MAAM,CACb,IAAI,EAAE,OAAO,EAAE;;;0BADR,MAAM;;AAEvB,+BAFiB,MAAM,6CAEf;AACR,QAAI,CAAC,IAAI,GAAG,2BAAS,CAAC;AACtB,QAAI,CAAC,KAAK,GAAG,IAAI,CAAC;AAClB,QAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;AACxB,QAAI,CAAC,sBAAsB,GAAG,SAAS,CAAC;;AAExC,QAAM,aAAa,GAAG;AACpB,YAAM,EAAE,CAAC;KACV,CAAC;;AAEF,QAAI,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,8BAAc,CAAC,cAAc,EAAE,aAAa,CAAC,CAAC,CAAC;AACpE,QAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,8BAAc,CAAC,eAAe,EAAE,aAAa,CAAC,CAAC,CAAC;AACtE,QAAI,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,8BAAc,CAAC,gBAAgB,EAAE,aAAa,CAAC,CAAC,CAAC;;AAExE,QAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,UAAU,EAAE,UAAC,GAAG,EAAE,GAAG,EAAK;AAC3C,SAAG,CAAC,IAAI,CAAC,iCAAc;AACrB,eAAO,EAAE,+CAA+C;AACxD,gBAAQ,EAAE,oDAAoD;AAC9D,eAAO,EAAE,oCAAiB;AACxB,iBAAO,EAAE,MAAK,QAAQ;AACtB,+BAAqB,EAAE,MAAK,sBAAsB;AAClD,yBAAe,EAAE,CACf,EAAC,KAAK,EAAE,SAAS,EAAE,KAAK,EAAE,SAAS,EAAC,EACpC,EAAC,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,EAAC,EAC9B,EAAC,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAC,EAClC,EAAC,KAAK,EAAE,SAAS,EAAE,KAAK,EAAE,SAAS,EAAC,CACrC,CAAC,GAAG,CAAC,UAAA,IAAI,EAAI;AACZ,gBAAI,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,KAAK,MAAK,sBAAsB,CAAC;AAC1D,mBAAO,IAAI,CAAC;WACb,CAAC;SACH,CAAC;OACH,CAAC,CAAC,CAAC;KACL,CAAC,CAAC;;AAEH,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,UAAU,EAAE,gCAAc,EAAE,UAAC,GAAG,EAAE,GAAG,EAAK;AAC/D,UAAI,CAAC,GAAG,CAAC,IAAI,IACV,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,IACxB,eAAe,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,EAAE;AACzD,eAAO,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;OAC5B;;AAED,SAAG,CAAC,IAAI,CAAC;AACP,UAAE,EAAE,IAAI;OACT,CAAC,CAAC;;AAEH,YAAK,sBAAsB,GAAG,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC;AACtD,YAAK,IAAI,CAAC,kBAAkB,EAAE,EAAC,IAAI,EAAE,GAAG,CAAC,IAAI,CAAC,cAAc,EAAC,CAAC,CAAC;KAChE,CAAC,CAAC;GACJ;;eAlDkB,MAAM;;WAoDnB,kBAAG;;;AACP,UAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,UAAA,CAAC,EAAI;AAChC,eAAO,CAAC,GAAG,CAAC,uCAAuC,GAAG,OAAK,KAAK,CAAC,CAAC;OACnE,CAAC,CAAC;KACJ;;;SAxDkB,MAAM;;;qBAAN,MAAM","file":"Settings.js","sourcesContent":["import express from 'express';\r\nimport zlib from 'zlib';\r\nimport compression from 'compression';\r\nimport {EventEmitter} from 'events';\r\nimport readFormBody from './readFormBody';\r\nimport indexTemplate from './templates/index';\r\nimport settingsTemplate from './templates/settings';\r\n\r\nconst compressor = compression({\r\n  flush: zlib.Z_PARTIAL_FLUSH\r\n});\r\n\r\nconst connectionTypes = ['perfect', 'slow', 'lie-fi', 'offline'];\r\n\r\nexport default class Server extends EventEmitter {\r\n  constructor(port, appPort) {\r\n    super();\r\n    this._app = express();\r\n    this._port = port;\r\n    this._appPort = appPort;\r\n    this._currentConnectionType = 'perfect';\r\n\r\n    const staticOptions = {\r\n      maxAge: 0\r\n    };\r\n\r\n    this._app.use('/js', express.static('../public/js', staticOptions));\r\n    this._app.use('/css', express.static('../public/css', staticOptions));\r\n    this._app.use('/imgs', express.static('../public/imgs', staticOptions));\r\n\r\n    this._app.get('/', compressor, (req, res) => {\r\n      res.send(indexTemplate({\r\n        scripts: '<script src=\"/js/settings.js\" defer></script>',\r\n        extraCss: '<link rel=\"stylesheet\" href=\"/css/settings.css\" />',\r\n        content: settingsTemplate({\r\n          appPort: this._appPort,\r\n          currentConnectionType: this._currentConnectionType,\r\n          connectionTypes: [\r\n            {value: 'perfect', title: \"Perfect\"},\r\n            {value: 'slow', title: \"Slow\"},\r\n            {value: 'lie-fi', title: \"Lie-fi\"},\r\n            {value: 'offline', title: \"Offline\"},\r\n          ].map(type => {\r\n            type.checked = type.value === this._currentConnectionType;\r\n            return type;\r\n          })\r\n        })\r\n      }));\r\n    });\r\n\r\n    this._app.post('/set', compressor, readFormBody(), (req, res) => {\r\n      if (!req.body\r\n      || !req.body.connectionType\r\n      || connectionTypes.indexOf(req.body.connectionType) == -1) {\r\n        return res.sendStatus(400);\r\n      }\r\n\r\n      res.send({\r\n        ok: true\r\n      });\r\n\r\n      this._currentConnectionType = req.body.connectionType;\r\n      this.emit('connectionChange', {type: req.body.connectionType});\r\n    });\r\n  }\r\n\r\n  listen() {\r\n    this._app.listen(this._port, _ => {\r\n      console.log(\"Config server listening at localhost:\" + this._port);\r\n    });\r\n  }\r\n}"]}