{"version":3,"sources":["readFormBody.js"],"names":[],"mappings":";;;;;;;;sBAAmB,QAAQ;;;;AAE3B,IAAM,OAAO,GAAG,6DAA6D,CAAC;;qBAE/D,YAAW;AACxB,SAAO,UAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAK;AACzB,QAAI,GAAG,CAAC,MAAM,KAAK,KAAK,IACrB,GAAG,CAAC,MAAM,KAAK,MAAM,IACrB,CAAC,OAAO,CAAC,GAAG,CAAC,IACb,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE;AAC3B,UAAI,EAAE,CAAC;AACP,aAAO;KACR;;AAED,QAAM,MAAM,GAAG,wBAAW;AACxB,aAAO,EAAE,GAAG,CAAC,OAAO;KACrB,CAAC,CAAC;;AAEH,OAAG,CAAC,IAAI,GAAG,EAAE,CAAC;;AAEd,UAAM,CAAC,EAAE,CAAC,QAAQ,EAAE,UAAA,CAAC;aAAI,IAAI,EAAE;KAAA,CAAC,CAAC;AACjC,UAAM,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,IAAI,EAAE,GAAG;aAAK,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG;KAAA,CAAC,CAAC;AACxD,OAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;GAClB,CAAC;CACH;;AAED,SAAS,OAAO,CAAC,GAAG,EAAE;AACpB,MAAM,QAAQ,IAAG,mBAAmB,IAAI,GAAG,CAAC,OAAO,CAAA,CAAC;AACpD,MAAM,MAAM,GAAG,gBAAgB,IAAI,GAAG,CAAC,OAAO,IAAI,GAAG,CAAC,OAAO,CAAC,gBAAgB,CAAC,KAAK,GAAG,CAAC;AACxF,SAAO,QAAQ,IAAI,MAAM,CAAC;CAC3B;;AAED,SAAS,IAAI,CAAC,GAAG,EAAE;AACjB,MAAI,GAAG,GAAG,GAAG,CAAC,OAAO,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC;AAC5C,SAAO,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;CAC1B","file":"readFormBody.js","sourcesContent":["import Busboy from 'busboy';\r\n\r\nconst RE_MIME = /^(?:multipart\\/.+)|(?:application\\/x-www-form-urlencoded)$/i;\r\n\r\nexport default function() {\r\n  return (req, res, next) => {\r\n    if (req.method === 'GET'\r\n    || req.method === 'HEAD'\r\n    || !hasBody(req)\r\n    || !RE_MIME.test(mime(req))) {\r\n      next();\r\n      return;\r\n    }\r\n\r\n    const busboy = new Busboy({\r\n      headers: req.headers\r\n    });\r\n\r\n    req.body = {};\r\n\r\n    busboy.on('finish', _ => next());\r\n    busboy.on('field', (name, val) => req.body[name] = val);\r\n    req.pipe(busboy);\r\n  };\r\n}\r\n\r\nfunction hasBody(req) {\r\n  const encoding = 'transfer-encoding' in req.headers;\r\n  const length = 'content-length' in req.headers && req.headers['content-length'] !== '0';\r\n  return encoding || length;\r\n}\r\n\r\nfunction mime(req) {\r\n  var str = req.headers['content-type'] || '';\r\n  return str.split(';')[0];\r\n}"]}